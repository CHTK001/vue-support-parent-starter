<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Codec WASM Browser Test</title>
</head>
<body>
    <h1>Codec WASM Browser Test</h1>
    <div id="result"></div>

    <script type="module">
        import { initWasm, generateNonce, generateSign, md5Hash, uu4_wasm } from './src/index.js';

        function runTest() {
            const resultElement = document.getElementById('result');
            
            try {
                resultElement.innerHTML += '<p>正在加载WASM模块...</p>';
                
                // 初始化WASM模块
                initWasm();
                
                // 测试generateNonce
                const nonce = generateNonce();
                resultElement.innerHTML += `<p>generateNonce测试通过: ${nonce}</p>`;
                
                // 测试md5Hash
                const hash = md5Hash('test');
                resultElement.innerHTML += `<p>md5Hash测试通过: ${hash}</p>`;
                
                // 测试generateSign
                const signature = generateSign('name=test&age=25', Date.now(), nonce, 'secret');
                resultElement.innerHTML += `<p>generateSign测试通过: ${signature}</p>`;
                
                // 测试uu4_wasm
                const testResponse = {
                    data: '02testdata1234',
                    uuid: 'test-uuid',
                    timestamp: '1234567890'
                };
                const uu4Result = uu4_wasm(testResponse);
                resultElement.innerHTML += `<p>uu4_wasm测试通过: ${uu4Result}</p>`;
                
                resultElement.innerHTML += '<p style="color: green;">所有测试通过！</p>';
            } catch (error) {
                resultElement.innerHTML += `<p style="color: red;">测试失败: ${error.message}</p>`;
                console.error(error);
            }
        }

        runTest();
    </script>
</body>
</html>