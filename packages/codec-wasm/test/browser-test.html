<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Browser Test</title>
</head>
<body>
    <h1>WASM Browser Test</h1>
    <button id="testBtn">Run Tests</button>
    <div id="result"></div>

    <script type="module">
        import { uu1_wasm, uu2_wasm, uu3_wasm, uu4_wasm, loadWasm } from '../src/index.js';

        // Mock config function
        const getConfig = (key) => {
            const config = {
                requestCodecOpen: 'true',
                codecRequestKey: '1234567890123456',
                responseCodecOpen: 'true',
                codecResponseKey: '1234567890123456'
            };
            return config[key] || '';
        };

        document.getElementById('testBtn').addEventListener('click', async () => {
            try {
                // Load WASM module
                await loadWasm();
                
                // Test uu2_wasm (request encryption)
                const requestFunc = (key) => {
                    const requestData = '{"name":"test","value":"data"}';
                    const requestUrl = '/api/test';
                    switch (key) {
                        case 'data': return requestData;
                        case 'url': return requestUrl;
                        default: return '';
                    }
                };
                
                const encryptedResult = uu2_wasm(requestFunc, getConfig);
                console.log('uu2_wasm result:', encryptedResult);
                
                // Test uu1_wasm (response decryption)
                const responseFunc = (key) => {
                    const responseData = encryptedResult;
                    switch (key) {
                        case 'data': return responseData;
                        default: return '';
                    }
                };
                
                const decryptedResult = uu1_wasm(responseFunc);
                console.log('uu1_wasm result:', decryptedResult);
                
                // Test uu3_wasm (simple encryption)
                const simpleEncrypted = uu3_wasm('Hello World', getConfig);
                console.log('uu3_wasm result:', simpleEncrypted);
                
                // Test uu4_wasm (simple decryption)
                const simpleDecrypted = uu4_wasm((key) => {
                    switch (key) {
                        case 'data': return simpleEncrypted;
                        default: return '';
                    }
                });
                console.log('uu4_wasm result:', simpleDecrypted);
                
                document.getElementById('result').innerHTML = `
                    <h2>Test Results:</h2>
                    <p><strong>uu2_wasm (Encryption):</strong> ${encryptedResult ? 'Success' : 'Failed'}</p>
                    <p><strong>uu1_wasm (Decryption):</strong> ${decryptedResult ? 'Success' : 'Failed'}</p>
                    <p><strong>uu3_wasm (Simple Encryption):</strong> ${simpleEncrypted ? 'Success' : 'Failed'}</p>
                    <p><strong>uu4_wasm (Simple Decryption):</strong> ${simpleDecrypted ? 'Success' : 'Failed'}</p>
                    <pre>${JSON.stringify({
                        encrypted: encryptedResult,
                        decrypted: decryptedResult,
                        simpleEncrypted: simpleEncrypted,
                        simpleDecrypted: simpleDecrypted
                    }, null, 2)}</pre>
                `;
            } catch (error) {
                console.error('Test failed:', error);
                document.getElementById('result').innerHTML = `<p style="color: red;">Test failed: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>