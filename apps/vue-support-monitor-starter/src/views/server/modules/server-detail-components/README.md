# 服务器详情组件系统

## 概述

服务器详情组件系统是一个独立的前端模块，专门用于管理和配置服务器监控组件。该系统提供了完整的组件生命周期管理功能，包括创建、编辑、预览、批量操作等。

## 目录结构

```
server-detail-components/
├── index.vue                          # 主页面入口
├── components/                        # 组件目录
│   ├── ComponentEditDialog.vue        # 组件编辑对话框
│   ├── ComponentPreviewDialog.vue     # 组件预览对话框
│   ├── BatchOperationDialog.vue       # 批量操作对话框
│   ├── ExpressionHelpDialog.vue       # 表达式帮助对话框
│   └── previews/                      # 预览组件目录
│       ├── CardPreview.vue            # 卡片预览组件
│       ├── GaugePreview.vue           # 仪表盘预览组件
│       ├── LinePreview.vue            # 折线图预览组件
│       ├── BarPreview.vue             # 柱状图预览组件
│       ├── PiePreview.vue             # 饼图预览组件
│       └── TablePreview.vue           # 表格预览组件
└── README.md                          # 说明文档
```

## 功能特性

### 1. 组件管理
- **服务器选择**: 支持选择不同服务器进行组件管理
- **组件列表**: 显示服务器的所有组件配置
- **过滤搜索**: 支持按组件类型、表达式类型、启用状态过滤
- **分页显示**: 支持大量组件的分页展示

### 2. 组件编辑
- **创建组件**: 支持创建新的监控组件
- **编辑组件**: 修改现有组件的配置
- **组件类型**: 支持卡片、仪表盘、折线图、柱状图、饼图、表格等类型
- **表达式支持**: 支持Prometheus PromQL和SQL两种查询表达式
- **配置验证**: 提供表达式和配置格式验证功能

### 3. 组件预览
- **实时预览**: 支持组件的实时可视化预览
- **数据查询**: 可以执行组件查询并显示结果
- **配置查看**: 查看组件的详细配置信息
- **多标签页**: 支持可视化预览、配置信息、查询结果多个视图

### 4. 批量操作
- **批量启用/禁用**: 批量修改组件的启用状态
- **批量排序**: 批量设置组件的排序序号
- **批量配置**: 批量更新组件的配置信息
- **批量克隆**: 将组件克隆到其他服务器
- **批量删除**: 批量删除选中的组件

### 5. 辅助功能
- **表达式帮助**: 提供Prometheus和SQL表达式的语法帮助
- **默认组件**: 支持为服务器初始化默认监控组件
- **配置生成**: 提供默认配置和位置信息的自动生成

## 组件类型

### 1. 卡片组件 (Card)
- 用于显示单一指标值
- 支持趋势指示器
- 支持自定义颜色和样式
- 适合显示CPU使用率、内存使用率等关键指标

### 2. 仪表盘组件 (Gauge)
- 用于显示百分比类型的指标
- 支持阈值颜色变化
- 支持自定义范围和刻度
- 适合显示使用率、完成度等指标

### 3. 折线图组件 (Line)
- 用于显示时间序列数据
- 支持平滑曲线和面积填充
- 支持多系列数据展示
- 适合显示趋势变化数据

### 4. 柱状图组件 (Bar)
- 用于显示分类数据对比
- 支持水平和垂直方向
- 支持多系列数据
- 适合显示统计对比数据

### 5. 饼图组件 (Pie)
- 用于显示占比数据
- 支持环形图模式
- 支持自定义颜色方案
- 适合显示资源分布情况

### 6. 表格组件 (Table)
- 用于显示详细的列表数据
- 支持排序和分页
- 支持自定义列配置
- 适合显示日志、事件等详细信息

## 表达式类型

### 1. Prometheus PromQL
- 支持标准的Prometheus查询语言
- 提供常用函数和操作符说明
- 包含系统监控的示例表达式
- 支持实时数据查询和历史数据分析

### 2. SQL查询
- 支持标准SQL语法
- 提供可用表结构说明
- 包含常用查询示例
- 支持复杂的聚合和分析查询

## 使用指南

### 1. 创建组件
1. 选择目标服务器
2. 点击"添加组件"按钮
3. 填写组件基本信息（名称、标题、类型等）
4. 选择表达式类型并输入查询表达式
5. 配置组件位置和样式
6. 保存组件配置

### 2. 编辑组件
1. 在组件列表中找到目标组件
2. 点击"编辑"按钮
3. 修改组件配置
4. 验证表达式和配置格式
5. 保存修改

### 3. 预览组件
1. 在组件列表中点击"预览"按钮
2. 查看组件的可视化效果
3. 执行查询获取实时数据
4. 检查配置信息和查询结果

### 4. 批量操作
1. 选择多个组件（使用复选框）
2. 点击"批量操作"按钮
3. 选择操作类型（启用/禁用、排序、配置等）
4. 设置操作参数
5. 确认并执行操作

### 5. 初始化默认组件
1. 选择新的服务器
2. 点击"初始化默认组件"按钮
3. 系统会自动创建一些预设的监控组件
4. 可以根据需要进一步编辑和调整

## 配置示例

### 卡片组件配置
```json
{
  "color": "#1890ff",
  "backgroundColor": "#f0f9ff",
  "borderRadius": "8px",
  "unit": "%",
  "decimals": 1,
  "showHeader": true,
  "showFooter": true,
  "icon": "ri:cpu-line",
  "description": "CPU使用率"
}
```

### 仪表盘组件配置
```json
{
  "color": "#52c41a",
  "min": 0,
  "max": 100,
  "unit": "%",
  "decimals": 1,
  "thresholds": {
    "warning": 70,
    "danger": 90
  },
  "radius": "80%"
}
```

### 位置配置
```json
{
  "x": 0,
  "y": 0,
  "w": 4,
  "h": 3,
  "i": "component_1"
}
```

## API接口

系统使用以下API接口与后端通信：

- `GET /v1/gen/server/component/list/{serverId}` - 获取组件列表
- `POST /v1/gen/server/component/create` - 创建组件
- `PUT /v1/gen/server/component/{componentId}` - 更新组件
- `DELETE /v1/gen/server/component/{componentId}` - 删除组件
- `POST /v1/gen/server/component/query/{componentId}` - 执行查询
- `POST /v1/gen/server/component/validate/{serverId}` - 验证表达式
- `POST /v1/gen/server/component/init/{serverId}` - 初始化默认组件

## 技术栈

- **Vue 3**: 前端框架
- **TypeScript**: 类型安全
- **Element Plus**: UI组件库
- **ECharts**: 图表库
- **Vite**: 构建工具

## 注意事项

1. **权限控制**: 确保用户有相应的服务器管理权限
2. **数据安全**: 表达式中不要包含敏感信息
3. **性能优化**: 避免创建过于复杂的查询表达式
4. **兼容性**: 确保表达式与目标数据源兼容
5. **备份**: 重要配置建议定期备份

## 扩展开发

如需添加新的组件类型或功能：

1. 在`previews/`目录下创建新的预览组件
2. 在`ComponentEditDialog.vue`中添加新的组件类型选项
3. 在`ComponentPreviewDialog.vue`中注册新的预览组件
4. 更新相关的类型定义和配置选项
5. 添加相应的API接口支持

## 维护说明

- 定期检查组件配置的有效性
- 监控查询性能，优化慢查询
- 及时清理无效或过期的组件
- 保持与后端API的同步更新
