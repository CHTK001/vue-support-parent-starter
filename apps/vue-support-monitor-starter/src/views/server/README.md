# 服务器管理功能

## 功能概述

服务器管理模块提供了完整的远程服务器管理功能，支持SSH、RDP、VNC等多种连接协议，实现了服务器的统一管理、监控和操作。新增了实时数据推送、在线状态检测和指标收集功能。

## 主要功能

### 🖥️ 服务器管理
- **服务器列表**: 卡片式展示所有服务器，支持按协议、状态筛选
- **服务器配置**: 支持SSH、RDP、VNC三种协议的详细配置
- **连接管理**: 一键连接、断开、测试连接状态
- **批量操作**: 支持批量连接、断开、导出配置等操作

### 🔐 多协议支持
- **SSH**: 支持密码和密钥认证，可配置字符编码、超时时间
- **RDP**: 支持自定义分辨率、颜色深度等显示参数
- **VNC**: 支持只读模式、VNC密码认证

### 📊 实时监控
- **连接状态**: 实时显示服务器连接状态
- **在线检测**: 使用NetUtils.isConnectable自动检测服务器在线状态
- **系统指标**: CPU、内存、磁盘使用率实时监控
- **指标支持**: 可配置是否支持指标收集，定时任务只对支持指标的服务器进行数据采集
- **统计信息**: 服务器总数、在线数量、协议分布等
- **实时推送**: WebSocket实时推送服务器状态变化和指标数据

### 🖥️ 远程操作
- **SSH终端**: 基于xterm.js的Web终端，支持全屏、清屏、重连
- **RDP桌面**: WebSocket实时传输的远程桌面
- **VNC桌面**: 支持鼠标键盘交互的VNC客户端

### 📁 文件管理
- **文件浏览**: 支持列表和网格两种视图模式
- **文件操作**: 上传、下载、删除、重命名、新建文件夹
- **批量操作**: 批量下载、批量删除
- **路径导航**: 面包屑导航，快速跳转目录

## 技术架构

### 前端技术栈
- **Vue 3 + TypeScript**: 现代化的前端框架
- **Element Plus**: UI组件库
- **xterm.js**: Web终端组件
- **WebSocket**: 实时通信

### 后端集成
- **Spring Boot**: 后端服务框架
- **SshClient**: SSH连接管理
- **GuacamoleClient**: RDP/VNC协议支持
- **SocketIO**: 实时消息传输

## 文件结构

```
src/views/server/
├── index.vue                    # 服务器管理主页面
├── components/
│   ├── ServerEditDialog.vue     # 服务器编辑对话框
│   ├── ServerInfoDialog.vue     # 服务器详情对话框
│   ├── ServerTerminalDialog.vue # 终端对话框
│   └── ServerFilesDialog.vue    # 文件管理对话框
└── README.md                    # 说明文档

src/api/monitor/gen/
└── server.ts                    # 服务器管理API接口
```

## 使用说明

### 1. 添加服务器
1. 点击"新增服务器"按钮
2. 填写服务器基本信息（名称、地址、端口）
3. 选择协议类型（SSH/RDP/VNC）
4. 配置认证信息（用户名、密码/密钥）
5. 设置是否支持指标收集（影响定时任务是否采集该服务器指标）
6. 根据协议配置特定参数
7. 保存配置

### 2. 连接服务器
1. 在服务器列表中找到目标服务器
2. 点击"连接"按钮建立连接
3. 点击"终端"按钮打开远程终端/桌面
4. 进行远程操作

### 3. 文件管理
1. 点击服务器卡片的"更多" -> "文件管理"
2. 浏览服务器文件系统
3. 支持上传、下载、删除等操作
4. 支持新建文件夹、重命名等功能

### 4. 监控查看
1. 点击服务器卡片的"更多" -> "查看信息"
2. 查看服务器详细信息和系统指标
3. 查看连接历史和最近指标记录

### 5. 实时数据
1. 进入服务器管理页面自动连接WebSocket
2. 实时接收服务器状态变化通知
3. 支持指标的服务器会在卡片上显示实时CPU、内存、磁盘使用率
4. 在线状态会实时更新（绿色=在线，红色=离线，黄色=未知）
5. 定时任务会自动检测所有服务器的在线状态
6. 只有启用指标支持的服务器才会被定时任务收集指标数据

## API接口

### 主要接口
- `GET /monitor/api/v1/gen/server/page` - 分页查询服务器列表
- `POST /monitor/api/v1/gen/server/save` - 保存服务器配置
- `GET /monitor/api/v1/gen/server/test` - 测试服务器连接
- `POST /monitor/api/v1/gen/server/connect` - 连接服务器
- `POST /monitor/api/v1/gen/server/disconnect` - 断开服务器连接
- `GET /monitor/api/v1/gen/server/files` - 获取文件列表
- `POST /monitor/api/v1/gen/server/upload` - 上传文件
- `GET /monitor/api/v1/gen/server/download` - 下载文件

### WebSocket端点
- `/socket/ssh` - SSH终端连接
- `/websocket/rdp` - RDP桌面连接
- `/websocket/vnc` - VNC桌面连接
- `/gen/server` - 服务器实时数据推送

### WebSocket消息类型
- `server_status` - 服务器状态更新
- `server_metrics` - 服务器指标数据
- `server_online` - 服务器上线通知
- `server_offline` - 服务器离线通知
- `server_update` - 服务器信息更新
- `server_delete` - 服务器删除通知
- `server_add` - 服务器添加通知

## 配置说明

### SSH配置
- **字符编码**: UTF-8、GBK、GB2312
- **连接超时**: 1000-60000毫秒
- **认证方式**: 密码认证、密钥认证

### RDP配置
- **屏幕分辨率**: 800x600 到 1920x1080
- **颜色深度**: 16位、24位、32位

### VNC配置
- **VNC密码**: VNC服务器密码
- **只读模式**: 是否允许控制操作

## 注意事项

1. **安全性**: 服务器密码等敏感信息会加密存储
2. **网络**: 确保网络连通性，防火墙允许相应端口
3. **权限**: 确保用户账号有足够的操作权限
4. **性能**: 大量服务器时建议分批操作，避免性能问题
5. **兼容性**: 不同操作系统的终端特性可能有差异

## 扩展功能

### 计划中的功能
- [ ] 服务器分组管理
- [ ] 批量脚本执行
- [ ] 服务器性能图表
- [ ] 告警规则配置
- [ ] 操作日志审计
- [ ] 服务器模板功能

### 自定义扩展
可以通过以下方式扩展功能：
1. 添加新的协议支持
2. 扩展文件管理功能
3. 增加监控指标
4. 自定义操作按钮
5. 集成第三方工具

## 故障排除

### 常见问题
1. **连接失败**: 检查网络连通性、端口开放、认证信息
2. **终端乱码**: 调整字符编码设置
3. **文件上传失败**: 检查磁盘空间、权限设置
4. **性能问题**: 减少并发连接数、优化网络环境

### 调试方法
1. 查看浏览器控制台错误信息
2. 检查后端日志
3. 使用网络工具检查连接状态
4. 验证服务器配置正确性
