<template>
  <div class="sc-map-example">
    <el-card>
      <template #header>
        <div class="card-header">
          <h3>åœ°å›¾ç»„ä»¶ (ScMap)</h3>
          <p class="text-secondary">ä¸€ä¸ªå¤šåŠŸèƒ½åœ°å›¾ç»„ä»¶ï¼Œæ”¯æŒé«˜å¾·ã€ç™¾åº¦ã€å¤©åœ°å›¾ç­‰å¤šç§åœ°å›¾ç±»å?/p>
        </div>
      </template>

      <!-- å†…å®¹åŒºåŸŸå®¹å™¨ -->
      <div class="main-container">
        <!-- åœ°å›¾åŒºåŸŸ (å·¦ä¾§) -->
        <div class="map-section">
          <h4>ç»„ä»¶é¢„è§ˆ</h4>
          <div class="preview-container">
            <ScMap :key="mapKey" :type="mapType" :api-key="apiKey[mapType]" :center="mapCenter" :zoom="zoomLevel"
              :markers="markers" :height="height" :view-type="viewType" :drawing-control="drawingControl"
              :tools-options="toolsOptions" :tools-position="toolsPosition" :tools-collapsed="toolsCollapsed"
              :draggable="draggable" :scroll-wheel="scrollWheel"  ref="mapRef" @map-loaded="onMapLoaded"
              @marker-click="onMarkerClick" @map-click="onMapClick" @shape-created="onShapeCreated"
              @shape-click="onShapeClick" @shape-deleted="onShapeDeleted" @zoom-changed="onZoomChanged"
              @center-changed="onCenterChanged" @marker-created="onMarkerCreated" @cluster-click="onClusterClick"
              @hover-popover-show="onHoverPopoverShow" @hover-popover-hide="onHoverPopoverHide"
              @click-popover-show="onClickPopoverShow" @click-popover-hide="onClickPopoverHide"
              @marker-deleted="onMarkerDeleted">
            </ScMap>

            <div class="action-buttons mt-4">
              <el-button-group>
                <el-button type="primary" @click="addRandomMarker">æ·»åŠ éšæœºæ ‡è®°</el-button>
                <el-button type="danger" @click="clearMarkers">æ¸…é™¤æ ‡è®°</el-button>
                <el-button type="success" @click="restoreDefaultMarkers">æ¢å¤é»˜è®¤æ ‡è®°</el-button>
                <el-button type="info" @click="showAllMarkers">æ˜¾ç¤ºæ‰€æœ‰æ ‡è®°ç‚¹</el-button>
                <el-button type="success" @click="showViewBounds">è·å–å¯è§†åŒºåŸŸ</el-button>
                <el-button type="primary" @click="getVisibleMarkers">è·å–å¯è§†èŒƒå›´å†…æ ‡è®?/el-button>
                <el-button type="primary" @click="drawJiaojiangBoundary">ç»˜åˆ¶æ¤’æ±Ÿè¾¹ç•Œ</el-button>
              </el-button-group>
              
            </div>
          </div>
        </div>

        <!-- é…ç½®é¢æ¿ (å³ä¾§) -->
        <div class="config-section">
          <h4>é…ç½®é€‰é¡¹</h4>
          <div class="config-scroll-container thin-scrollbar">
            <el-form label-position="top" size="default">
              <el-form-item label="åœ°å›¾ç±»å‹">
                <el-radio-group v-model="mapType">
                  <el-radio label="amap">é«˜å¾·åœ°å›¾</el-radio>
                  <el-radio label="tmap">å¤©åœ°å›?/el-radio>
                </el-radio-group>
              </el-form-item>

              <el-form-item label="è§†å›¾ç±»å‹">
                <el-select v-model="viewType" class="w-100">
                  <el-option label="æ™®é€šè§†å›? value="normal" />
                  <el-option label="å«æ˜Ÿè§†å›¾" value="satellite" />
                  <el-option label="æ··åˆè§†å›¾" value="hybrid" />
                </el-select>
              </el-form-item>

              <el-form-item label="åœ°å›¾é«˜åº¦">
                <el-slider v-model="heightValue" :min="200" :max="600" :step="50" show-stops />
                <div class="height-hint">{{ height }}</div>
              </el-form-item>

              <el-form-item label="APIå¯†é’¥">
                <el-input v-model="apiKey[mapType]" placeholder="è¾“å…¥åœ°å›¾APIå¯†é’¥" />
              </el-form-item>

              <el-form-item label="ç¼©æ”¾çº§åˆ«">
                <el-slider v-model="zoomLevel" :min="3" :max="19" :step="1" show-stops />
              </el-form-item>

              <el-form-item label="ä¸­å¿ƒä½ç½®">
                <el-radio-group v-model="centerLocation" class="mb-2">
                  <el-radio-button label="beijing">åŒ—äº¬</el-radio-button>
                  <el-radio-button label="shanghai">ä¸Šæµ·</el-radio-button>
                  <el-radio-button label="guangzhou">å¹¿å·</el-radio-button>
                </el-radio-group>
                <div class="center-coords">
                  <el-input v-model="mapCenter[0]" placeholder="ç»åº¦" disabled>
                    <template #prepend>ç»åº¦</template>
                  </el-input>
                  <el-input v-model="mapCenter[1]" placeholder="çº¬åº¦" disabled>
                    <template #prepend>çº¬åº¦</template>
                  </el-input>
                </div>
              </el-form-item>

              <el-form-item label="åŠŸèƒ½æ§åˆ¶">
                <div class="control-options">
                  <el-checkbox v-model="draggable">å…è®¸æ‹–åŠ¨</el-checkbox>
                  <el-checkbox v-model="scrollWheel">å…è®¸æ»šè½®ç¼©æ”¾</el-checkbox>
                </div>
              </el-form-item>

              <el-form-item label="ç»˜å›¾å·¥å…·" v-if="mapType === 'amap'">
                <el-checkbox v-model="drawingControl" class="mb-2">å¯ç”¨ç»˜å›¾å·¥å…·</el-checkbox>
                <div v-if="drawingControl" class="drawing-tools-options">
                  <div class="tools-option-title mb-1">ç»˜å›¾å·¥å…·é€‰é¡¹ï¼?/div>
                  <div class="tools-checkbox-group">
                    <el-checkbox v-model="toolsOptions.circle">åœ†å½¢</el-checkbox>
                    <el-checkbox v-model="toolsOptions.polygon">å¤šè¾¹å½?/el-checkbox>
                    <el-checkbox v-model="toolsOptions.rectangle">çŸ©å½¢</el-checkbox>
                    <el-checkbox v-model="toolsOptions.polyline">çº¿æ®µ</el-checkbox>
                    <el-checkbox v-model="toolsOptions.distance">æµ‹è·</el-checkbox>
                    <el-checkbox v-model="toolsOptions.marker">æ ‡è®°ç‚?/el-checkbox>
                    <el-checkbox v-model="toolsOptions.clear">æ¸…é™¤</el-checkbox>
                    <el-checkbox v-model="toolsOptions.debug">è°ƒè¯•</el-checkbox>
                    <el-checkbox v-model="toolsOptions.position">æ˜¾ç¤ºåæ ‡</el-checkbox>
                    <el-checkbox v-model="toolsOptions.cluster">ç‚¹èšå?/el-checkbox>
                    <el-checkbox v-model="toolsOptions.showMarkers" @change="toggleMarkersVisibility">æ˜¾ç¤ºæ ‡è®°</el-checkbox>
                    <el-checkbox v-model="toolsOptions.showShapes" @change="toggleShapesVisibility">æ˜¾ç¤ºå›¾å½¢</el-checkbox>
                  </div>
                  <el-checkbox v-model="showCustomTools" class="mt-2">ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·æŒ‰é’?/el-checkbox>

                  <div class="tools-position-options mt-2">
                    <div class="tools-option-title mb-1">å·¥å…·é¢æ¿ä½ç½®ï¼?/div>
                    <el-radio-group v-model="toolsPosition" size="small">
                      <el-radio-button label="left-top">å·¦ä¸Š</el-radio-button>
                      <el-radio-button label="right-top">å³ä¸Š</el-radio-button>
                      <el-radio-button label="left-bottom">å·¦ä¸‹</el-radio-button>
                      <el-radio-button label="right-bottom">å³ä¸‹</el-radio-button>
                    </el-radio-group>
                  </div>
                </div>

                <div class="shape-info mt-2" v-if="drawnShapes.length > 0">
                  <div class="shape-info-label mb-1">å·²ç»˜åˆ¶å›¾å½?({{ drawnShapes.length }})</div>
                  <el-button type="danger" size="small" @click="clearShapes">æ¸…é™¤æ‰€æœ‰å›¾å½?/el-button>
                </div>
              </el-form-item>

              <!-- è¡Œç¨‹è½¨è¿¹é€‰é¡¹ -->
              <el-form-item label="è¡Œç¨‹è½¨è¿¹">
                <el-collapse-transition>
                  <div class="journey-options-panel">
                    <div class="journey-options-header">
                      <el-button size="small" type="text" @click="toggleJourneyOptions">
                        {{ showJourneyOptions ? 'æ”¶èµ·é€‰é¡¹' : 'è¯¦ç»†é€‰é¡¹' }}
                        <i :class="showJourneyOptions ? 'el-icon-arrow-up' : 'el-icon-arrow-down'"></i>
                      </el-button>
                    </div>
                    
                    <div v-if="showJourneyOptions" class="journey-options">
                      <el-form-item label="è½¨è¿¹çº¿é¢œè‰? size="small">
                        <el-color-picker v-model="journeyOptions.strokeColor" show-alpha size="small"></el-color-picker>
                      </el-form-item>
                      <el-form-item label="è½¨è¿¹çº¿å®½åº? size="small">
                        <el-slider v-model="journeyOptions.strokeWeight" :min="1" :max="10" :step="1"></el-slider>
                      </el-form-item>
                      <div class="journey-checkbox-group">
                        <el-checkbox v-model="journeyOptions.showStartEndMarkers">æ˜¾ç¤ºèµ·ç»ˆç‚¹æ ‡è®?/el-checkbox>
                        <el-checkbox v-model="journeyOptions.showPointMarkers">æ˜¾ç¤ºé€”ç»ç‚?/el-checkbox>
                        <el-checkbox v-model="journeyOptions.animation">æ’­æ”¾è½¨è¿¹åŠ¨ç”»</el-checkbox>
                      </div>
                      <el-form-item v-if="journeyOptions.showPointMarkers" label="é€”ç»ç‚¹é—´éš? size="small">
                        <el-slider v-model="journeyOptions.pointMarkersInterval" :min="1" :max="10" :step="1"></el-slider>
                      </el-form-item>
                      <el-form-item v-if="journeyOptions.animation" label="åŠ¨ç”»æ—¶é•¿(ç§?" size="small">
                        <el-slider v-model="journeyOptions.animationDurationInSeconds" :min="3" :max="30" :step="1"></el-slider>
                      </el-form-item>
                      <el-form-item v-if="journeyOptions.animation" label="Ñ­»·´ÎÊı" size="small">
                        <el-slider v-model="journeyOptions.loopCount" :min="0" :max="10" :step="1" :marks="{0: 'ÎŞÏŞ', 1: '1´Î', 5: '5´Î', 10: '10´Î'}"></el-slider>
                        <div class="loop-count-hint">{{ journeyOptions.loopCount === 0 ? 'ÎŞÏŞÑ­»·' : Ñ­»·´Î }}</div>
                      </el-form-item>
                    </div>
                    
                    <div class="journey-buttons mt-2">
                      <el-button-group>
                        <el-button size="small" type="primary" @click="createJourneyTrack">åˆ›å»ºè½¨è¿¹</el-button>
                        <el-button size="small" type="success" @click="generateRandomTrack" :disabled="!!journeyTrackInstance">éšæœºè½¨è¿¹</el-button>
                        <el-button size="small" type="danger" @click="clearJourneyTrack" v-if="journeyTrackInstance">æ¸…é™¤è½¨è¿¹</el-button>
                      </el-button-group>
                    </div>
                    
                    <div class="journey-animation-controls mt-2" v-if="journeyTrackInstance && journeyOptions.animation">
                      <el-button size="small" type="primary" icon="el-icon-video-pause" @click="pauseJourneyAnimation" v-if="!isJourneyAnimationPaused">æš‚åœ</el-button>
                      <el-button size="small" type="success" icon="el-icon-video-play" @click="resumeJourneyAnimation" v-else>ç»§ç»­</el-button>
                      <el-button size="small" type="danger" icon="el-icon-close" @click="stopJourneyAnimation">åœæ­¢</el-button>
                    </div>
                  </div>
                </el-collapse-transition>
              </el-form-item>
            </el-form>
          </div>
        </div>
      </div>

      <!-- ä»£ç ç¤ºä¾‹ -->
      <div class="code-example mt-4">
        <h4>ä»£ç ç¤ºä¾‹</h4>
        <el-alert type="info" :closable="false" class="mb-3">
          <div class="code-desc">æ ¹æ®å½“å‰é…ç½®ç”Ÿæˆçš„ä»£ç ç¤ºä¾?/div>
        </el-alert>
        <pre><code class="language-html">{{ codeExample }}</code></pre>
      </div>
    </el-card>

    <!-- æ•°æ®æ˜¾ç¤ºçª—å£ (å·¦ä¸‹è§? -->
    <div class="marker-data-panel" :class="{ expanded: showMarkerPanel }">
      <div class="panel-header" @click="toggleMarkerPanel">
        <span>æ•°æ®æ˜¾ç¤ºé¢æ¿</span>
        <i :class="showMarkerPanel ? 'el-icon-arrow-down' : 'el-icon-arrow-right'"></i>
      </div>
      <div class="panel-content thin-scrollbar" v-if="showMarkerPanel">
        <div v-if="isLoadingMarkers" class="loading-data">
          <i class="el-icon-loading"></i>
          <span>æ­£åœ¨åŠ è½½æ•°æ®...</span>
        </div>
        <pre v-else class="json-content">{{ JSON.stringify(markerData, null, 2) }}</pre>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch, onMounted, nextTick } from "vue";
import { ElMessage } from "element-plus";
import ScMap from "@repo/components/ScMap/index.vue";

// é…ç½®é€‰é¡¹
const mapType = ref("amap");
const apiKey = ref({
  amap: "5f969bed06ed949108d2ec7916dcffc4",
  tmap: "050980b15bce7aa8c13fb4a4c7b1a5e5",
});
const viewType = ref("normal");
const zoomLevel = ref(11);
const heightValue = ref(600);
const height = computed(() => `${heightValue.value}px`);
const draggable = ref(true);
const scrollWheel = ref(true);
const drawingControl = ref(true);
const showCustomTools = ref(true);
const toolsPosition = ref("left-top");
const toolsCollapsed = ref(false);
const toolsOptions = ref({
  circle: true,
  polygon: true,
  rectangle: true,
  polyline: true,
  distance: true,
  marker: true,
  clear: true,
  debug: true,
  position: true,
  cluster: true,
  showMarkers: true,
  showShapes: true,
});

// å›¾å½¢ç±»å‹åç§°æ˜ å°„
const shapeTypeNames = {
  circle: "åœ†å½¢",
  polygon: "å¤šè¾¹å½?,
  rectangle: "çŸ©å½¢",
  polyline: "çº¿æ®µ",
};

// åœ°å›¾å®ä¾‹å‚è€?const mapRef = ref(null);
const mapKey = ref(0); // ç”¨äºå¼ºåˆ¶é‡æ–°æ¸²æŸ“åœ°å›¾ç»„ä»¶

onMounted(() => {
  nextTick(() => {
    console.log("åœ°å›¾å®ä¾‹", mapRef.value);
    /**
     * {
  "description": "åˆ›å»ºçš„å›¾å½¢ä¿¡æ?,
  "type": "åœ†å½¢",
  "id": "shape_1745052041418_152",
  "properties": {
    "center": [
      116.249456,
      39.945563
    ],
    "radius": 5182.38
  }
}
     */
  });
});
// å½“å‰ä½ç½®
const centerLocation = ref("beijing");
const locationMap = {
  beijing: [116.397428, 39.90923],
  shanghai: [121.473701, 31.230416],
  guangzhou: [113.264385, 23.129112],
};
const mapCenter = ref(locationMap.beijing);

// ç›‘å¬é€‰ä¸­çš„ä½ç½®å˜åŒ?watch(centerLocation, (newLocation) => {
  mapCenter.value = locationMap[newLocation];
});

// æ ‡è®°ç‚¹æ•°æ?const defaultMarkers = [
  {
    position: [116.397428, 39.90923],
    title: "åŒ—äº¬å¸‚ä¸­å¿?,
    label: "åŒ—äº¬å¸‚ä¸­å¿?,
    size: [16, 25],
    icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
    data: { id: "BJ001" },
  },
  {
    position: [116.326661, 39.897413],
    title: "åŒ—äº¬è¥¿ç«™",
    label: "åŒ—äº¬è¥¿ç«™",
    size: [16, 25],
    icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
    data: { id: "BJ002" },
  },
  {
    position: [116.383223, 39.939108],
    title: "åŒ—äº¬åŠ¨ç‰©å›?,
    label: "åŒ—äº¬åŠ¨ç‰©å›?,
    size: [16, 25],
    icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png",
    data: { id: "BJ003" },
  },
];
const markers = ref([
  {
    markerId: '1',
    position: [116.397428, 39.90923],
    title: 'åŒ—äº¬å¸‚ä¸­å¿?,
    label: 'å¤©å®‰é—¨å¹¿åœ?,
    icon: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
    data: { id: 'BJ001' },
  },
  {
    markerId: '2',
    position: [116.331398, 39.897445],
    title: 'åŒ—äº¬åŠ¨ç‰©å›?,
    label: 'åŒ—äº¬åŠ¨ç‰©å›?,
    icon: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-2.png',
    data: { id: 'BJ002' },
    clickPopover: true,  // å¯ç”¨ç‚¹å‡»å¼¹çª—
    clickPopoverTemplate: `
      <div style="padding:8px;">
        <h3 style="margin:0;color:#52c41a;font-size:16px;">\${marker.title}</h3>
        <p style="margin:5px 0;font-size:13px;">\${marker.label}</p>
        <div style="margin-top:8px;font-size:12px;color:#999;">ID: \${marker.data.id}</div>
      </div>
    `
  },
  {
    markerId: '3',
    position: [116.442348, 39.908127],
    title: 'æœé˜³å…¬å›­',
    label: 'æœé˜³å…¬å›­',
    icon: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-3.png',
    data: { id: 'BJ003' },
    clickPopover: true,  // åŒæ—¶å¯ç”¨ç‚¹å‡»å¼¹çª—
    clickPopoverTemplate: `
      <div style="padding:10px;">
        <h3 style="margin:0;color:#722ed1;font-size:16px;">\${marker.title}</h3>
        <p style="margin:5px 0;font-size:13px;">\${marker.label}</p>
        <div style="margin-top:10px;font-size:12px;color:#666;">
          <p>ID: \${marker.data.id}</p>
          <p>ä½ç½®: \${marker.position[0].toFixed(6)}, \${marker.position[1].toFixed(6)}</p>
        </div>
      </div>
    `
  }
]);
const currentMarker = ref(null);

// ç›‘å¬åœ°å›¾ç±»å‹å˜åŒ–
watch(mapType, () => {
  // ä¿®æ”¹keyå€¼ï¼Œå¼ºåˆ¶é‡æ–°æ¸²æŸ“åœ°å›¾ç»„ä»¶
  mapKey.value += 1;
  drawnShapes.value = [];
  selectedShape.value = null;
  currentDrawing.value = "";
  
});

// åœ°å›¾åŠ è½½å®Œæˆäº‹ä»¶
const onMapLoaded = (map) => {
  console.log("åœ°å›¾åŠ è½½å®Œæˆ", map);
  
  ElMessage.success("åœ°å›¾åŠ è½½å®Œæˆ");
  
  // å»¶è¿Ÿæ·»åŠ é»˜è®¤å›¾å½¢ï¼Œç¡®ä¿åœ°å›¾å·²å®Œå…¨åˆå§‹åŒ?  setTimeout(() => {
    if (mapRef.value) {
      try {
        // æ·»åŠ ç¬¬ä¸€ä¸ªåœ†å½?- è“è‰²
        const circle1 = mapRef.value.addCircle(
          [mapCenter.value[0] - 0.02, mapCenter.value[1] + 0.02], // ä¸­å¿ƒç‚¹åæ ?- å·¦ä¸Šè§?          1000, // åŠå¾„ï¼ˆç±³ï¼?          { 
            strokeColor: '#1890ff', 
            strokeWeight: 2, 
            strokeOpacity: 0.8,
            fillColor: '#1890ff', 
            fillOpacity: 0.2
          },
          'demo-circle-1' // å›¾å½¢ID
        );
        
        // æ·»åŠ ç¬¬äºŒä¸ªåœ†å½?- ç»¿è‰²
        const circle2 = mapRef.value.addCircle(
          [mapCenter.value[0] + 0.02, mapCenter.value[1] + 0.02], // ä¸­å¿ƒç‚¹åæ ?- å³ä¸Šè§?          800, // åŠå¾„ï¼ˆç±³ï¼?          { 
            strokeColor: '#52c41a', 
            strokeWeight: 2, 
            strokeOpacity: 0.8,
            fillColor: '#52c41a', 
            fillOpacity: 0.2
          },
          'demo-circle-2' // å›¾å½¢ID
        );
        
        // æ·»åŠ ä¸€ä¸ªçŸ©å½?- æ©™è‰²
        const rectangle = mapRef.value.addRectangle(
          [
            [mapCenter.value[0] - 0.02, mapCenter.value[1] - 0.02], // å·¦ä¸‹è§?            [mapCenter.value[0] + 0.02, mapCenter.value[1] - 0.01]  // å³ä¸Šè§?          ],
          { 
            strokeColor: '#faad14', 
            strokeWeight: 2, 
            strokeOpacity: 0.8,
            fillColor: '#faad14', 
            fillOpacity: 0.2
          },
          'demo-rectangle-1' // å›¾å½¢ID
        );
        
        console.log("å·²æ·»åŠ æ¼”ç¤ºå›¾å½¢ï¼š2ä¸ªåœ†å½¢å’Œ1ä¸ªçŸ©å½?);
        
        // æ˜¾ç¤ºå›¾å½¢æ•°æ®
        markerData.value = {
          description: "åœ°å›¾åˆå§‹åŒ–é»˜è®¤å›¾å½?,
          shapes: [
            {
              id: "demo-circle-1",
              type: "circle",
              center: [mapCenter.value[0] - 0.02, mapCenter.value[1] + 0.02],
              radius: 1000,
              color: "#1890ff"
            },
            {
              id: "demo-circle-2",
              type: "circle",
              center: [mapCenter.value[0] + 0.02, mapCenter.value[1] + 0.02],
              radius: 800,
              color: "#52c41a"
            },
            {
              id: "demo-rectangle-1",
              type: "rectangle",
              bounds: [
                [mapCenter.value[0] - 0.02, mapCenter.value[1] - 0.02],
                [mapCenter.value[0] + 0.02, mapCenter.value[1] - 0.01]
              ],
              color: "#faad14"
            }
          ]
        };
        
        // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
        if (!showMarkerPanel.value) {
          toggleMarkerPanel();
        }
      } catch (error) {
        console.error("æ·»åŠ é»˜è®¤å›¾å½¢å¤±è´¥:", error);
        ElMessage.error("æ·»åŠ é»˜è®¤å›¾å½¢å¤±è´¥");
      }
    }
  }, 500);
};

// æ ‡è®°ç‚¹ç‚¹å‡»äº‹ä»?const onMarkerClick = (marker) => {
  currentMarker.value = marker;
  // æ˜¾ç¤ºæ–°åˆ›å»ºçš„æ ‡è®°ç‚¹æ•°æ?  markerData.value = {
    description: "onMarkerClickæ–°åˆ›å»ºçš„æ ‡è®°ç‚?,
    marker: {
      position: [Number(marker.position[0].toFixed(6)), Number(marker.position[1].toFixed(6))],
      title: marker.title,
      id: marker.markerId,
    },
  };
  console.log("æ ‡è®°ç‚¹ç‚¹å‡?, marker);
  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }
};

// åœ°å›¾ç‚¹å‡»äº‹ä»¶
const onMapClick = (event) => {
  console.log("åœ°å›¾ç‚¹å‡»", event);
};

// ç¼©æ”¾çº§åˆ«å˜åŒ–äº‹ä»¶
const onZoomChanged = (zoom) => {
  zoomLevel.value = zoom;
  console.log("ç¼©æ”¾çº§åˆ«å˜åŒ–", zoom);
};

// ä¸­å¿ƒç‚¹å˜åŒ–äº‹ä»?const onCenterChanged = (center) => {
  mapCenter.value = center;
  console.log("ä¸­å¿ƒç‚¹å˜åŒ?, center);
};

// æ ‡è®°ç‚¹åˆ›å»ºäº‹ä»?const onMarkerCreated = (marker) => {
  console.log("æ ‡è®°ç‚¹åˆ›å»?, marker);
  // å°†æ–°åˆ›å»ºçš„æ ‡è®°æ·»åŠ åˆ°æ ‡è®°æ•°ç»„ä¸?  markers.value.push(marker);

  // æ˜¾ç¤ºæ–°åˆ›å»ºçš„æ ‡è®°ç‚¹æ•°æ?  markerData.value = {
    description: "onMarkerCreatedæ–°åˆ›å»ºçš„æ ‡è®°ç‚?,
    marker: {
      position: [Number(marker.position[0].toFixed(6)), Number(marker.position[1].toFixed(6))],
      title: marker.title,
      id: marker.data?.id,
    },
  };

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  ElMessage.success("æ ‡è®°ç‚¹åˆ›å»ºæˆåŠ?);

  // æ£€æŸ¥æ ‡è®°æ ‡ç­¾æ˜¾ç¤ºçŠ¶æ€?  const shouldShowLabels = !!document.querySelector('.sc-map-marker-label');

  // å¦‚æœæœ‰æ ‡ç­¾å¹¶ä¸”å½“å‰æ˜¾ç¤ºæ ‡ç­¾ï¼Œåˆ™ä¸ºæ ‡è®°ç‚¹æ·»åŠ æ ‡ç­?  if (marker.label && shouldShowLabels) {
    try {
      const label = new window.T.Label({
        text: marker.label,
        position: marker.position,
        offset: new window.T.Point(20, -10)
      });

      mapRef.value.addOverLay(label);
      currentMarker.value.__labelInstance = label;
    } catch (err) {
      console.error('åˆ›å»ºæ ‡è®°æ ‡ç­¾æ—¶å‡ºé”?', err);
    }
  }
};

// æ·»åŠ éšæœºæ ‡è®°
const addRandomMarker = () => {
  // åœ¨å½“å‰ä¸­å¿ƒç‚¹é™„è¿‘éšæœºç”Ÿæˆåæ ‡
  const randomLng = mapCenter.value[0] + (Math.random() - 0.5) * 0.1;
  const randomLat = mapCenter.value[1] + (Math.random() - 0.5) * 0.1;

  // éšæœºå†³å®šå¼¹çª—ç±»å‹
  const randomPopoverType = Math.floor(Math.random() * 3); // 0: æ— å¼¹çª? 1: æ‚¬åœå¼¹çª—, 2: ç‚¹å‡»å¼¹çª—, 3: ä¸¤è€…éƒ½æœ?
  const newMarker = {
    position: [randomLng, randomLat],
    title: `éšæœºæ ‡è®° ${markers.value.length + 1}`,
    icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
    data: { id: `RANDOM_${Date.now()}` },
    size: [16, 25],
    clickPopover: true,
    clickPopoverTemplate: `
      <div style="padding:8px;">
        <h3 style="margin:0;color:#f5222d;font-size:14px;">\${marker.title}</h3>
        <p style="margin:5px 0;font-size:12px;">éšæœºä½ç½®: \${marker.position[0].toFixed(6)}, \${marker.position[1].toFixed(6)}</p>
        <div style="margin-top:8px;font-size:12px;color:#999;">ID: \${marker.data.id}</div>
      </div>
    `
  };

  markers.value.push(newMarker);

  // æ˜¾ç¤ºæ–°æ ‡è®°ç‚¹æ•°æ®
  markerData.value = {
    description: "æ–°æ·»åŠ çš„éšæœºæ ‡è®°ç‚?,
    marker: {
      position: [Number(randomLng.toFixed(6)), Number(randomLat.toFixed(6))],
      title: newMarker.title,
      id: newMarker.data.id,
      popoverType: randomPopoverType === 0 ? "æ— å¼¹çª? :
        randomPopoverType === 1 ? "æ‚¬åœå¼¹çª—" :
          randomPopoverType === 2 ? "ç‚¹å‡»å¼¹çª—" : "æ‚¬åœ+ç‚¹å‡»å¼¹çª—"
    }
  };

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  ElMessage.success("å·²æ·»åŠ éšæœºæ ‡è®?);

  // æ£€æŸ¥æ ‡è®°æ ‡ç­¾æ˜¾ç¤ºçŠ¶æ€?  const shouldShowLabels = !!document.querySelector('.sc-map-marker-label');

  // å¦‚æœæœ‰æ ‡ç­¾å¹¶ä¸”å½“å‰æ˜¾ç¤ºæ ‡ç­¾ï¼Œåˆ™ä¸ºæ ‡è®°ç‚¹æ·»åŠ æ ‡ç­?  if (newMarker.label && shouldShowLabels) {
    try {
      const label = new window.T.Label({
        text: newMarker.label,
        position: newMarker.position,
        offset: new window.T.Point(20, -10)
      });

      mapRef.value.addOverLay(label);
      newMarker.__labelInstance = label;
    } catch (err) {
      console.error('åˆ›å»ºæ ‡è®°æ ‡ç­¾æ—¶å‡ºé”?', err);
    }
  }
};

// æ¸…é™¤æ‰€æœ‰æ ‡è®?const clearMarkers = () => {
  markers.value = [];
  currentMarker.value = null;

  // æ¸…ç©ºæ•°æ®é¢æ¿
  markerData.value = {
    description: "æ ‡è®°ç‚¹æ“ä½?,
    action: "å·²æ¸…é™¤æ‰€æœ‰æ ‡è®°ç‚¹",
  };

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  ElMessage.success("å·²æ¸…é™¤æ‰€æœ‰æ ‡è®?);
};

// æ¢å¤é»˜è®¤æ ‡è®°
const restoreDefaultMarkers = () => {
  markers.value = [...defaultMarkers];
  currentMarker.value = null;

  // æ˜¾ç¤ºé»˜è®¤æ ‡è®°ç‚¹æ•°æ?  markerData.value = {
    description: "å·²æ¢å¤é»˜è®¤æ ‡è®°ç‚¹",
    count: defaultMarkers.length,
    markers: defaultMarkers.map((marker, index) => {
      return {
        id: index + 1,
        position: [Number(marker.position[0].toFixed(6)), Number(marker.position[1].toFixed(6))],
        title: marker.title,
        dataId: marker.data?.id,
      };
    }),
  };

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  ElMessage.success("å·²æ¢å¤é»˜è®¤æ ‡è®?);
};

// å¼€å§‹ç»˜åˆ¶å›¾å½?const startDrawing = (type) => {
  if (mapRef.value) {
    currentDrawing.value = type;
    mapRef.value.startDrawing(type);
    ElMessage.info(`å¼€å§‹ç»˜åˆ?{shapeTypeNames[type]}`);
  }
};

// åœæ­¢ç»˜åˆ¶
const stopDrawing = () => {
  if (mapRef.value) {
    mapRef.value.stopDrawing();
    currentDrawing.value = "";
    ElMessage.info("å·²åœæ­¢ç»˜åˆ?);
  }
};

// å›¾å½¢åˆ›å»ºäº‹ä»¶
const onShapeCreated = (shape) => {
  console.log("å›¾å½¢åˆ›å»º", shape);
  drawnShapes.value.push(shape);
  selectedShape.value = shape;
  currentDrawing.value = "";

  // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºåˆ›å»ºçš„å›¾å½¢ä¿¡æ?  markerData.value = {
    description: "åˆ›å»ºçš„å›¾å½¢ä¿¡æ?,
    type: shapeTypeNames[shape.type] || shape.type,
    id: shape.id,
    properties: {},
  };

  // æ ¹æ®å›¾å½¢ç±»å‹æ·»åŠ ä¸åŒçš„å±æ€§ä¿¡æ?  if (shape.type === "circle") {
    markerData.value.properties.center = [Number(shape.path[0][0].toFixed(6)), Number(shape.path[0][1].toFixed(6))];
    markerData.value.properties.radius = Number(shape.radius.toFixed(2));
  } else {
    markerData.value.properties.points = shape.path.map((point) => [Number(point[0].toFixed(6)), Number(point[1].toFixed(6))]);
  }

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  ElMessage.success(`${shapeTypeNames[shape.type]}åˆ›å»ºæˆåŠŸ`);
};

// å›¾å½¢ç‚¹å‡»äº‹ä»¶
const onShapeClick = (event) => {
  console.log("å›¾å½¢ç‚¹å‡»", event);
  selectedShape.value = event.shape;

  // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºç‚¹å‡»çš„å›¾å½¢ä¿¡æ?  markerData.value = {
    description: "ç‚¹å‡»çš„å›¾å½¢ä¿¡æ?,
    type: shapeTypeNames[event.shape.type] || event.shape.type,
    id: event.shape.id,
    clickPosition: [Number(event.position[0].toFixed(6)), Number(event.position[1].toFixed(6))],
    properties: {},
  };

  // æ ¹æ®å›¾å½¢ç±»å‹æ·»åŠ ä¸åŒçš„å±æ€§ä¿¡æ?  if (event.shape.type === "circle") {
    markerData.value.properties.center = [Number(event.shape.path[0][0].toFixed(6)), Number(event.shape.path[0][1].toFixed(6))];
    markerData.value.properties.radius = Number(event.shape.radius.toFixed(2));
  } else {
    markerData.value.properties.points = event.shape.path.map((point) => [Number(point[0].toFixed(6)), Number(point[1].toFixed(6))]);
  }

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }
};

// å›¾å½¢åˆ é™¤äº‹ä»¶
const onShapeDeleted = (shapeId) => {
  console.log("å›¾å½¢åˆ é™¤", shapeId);
  drawnShapes.value = drawnShapes.value.filter((shape) => shape.id !== shapeId);
  if (selectedShape.value && selectedShape.value.id === shapeId) {
    selectedShape.value = null;
  }
  ElMessage.success("å›¾å½¢å·²åˆ é™?);
};

// åˆ é™¤å›¾å½¢
const removeShape = (shapeId) => {
  if (mapRef.value) {
    mapRef.value.removeShape(shapeId);
    drawnShapes.value = drawnShapes.value.filter((shape) => shape.id !== shapeId);
    if (selectedShape.value && selectedShape.value.id === shapeId) {
      selectedShape.value = null;
    }
    ElMessage.success("å›¾å½¢å·²åˆ é™?);
  }
};

// è·å–æ‰€æœ‰æ ‡è®°ç‚¹
const getAllMarkers = () => {
  if (mapRef.value) {
    return mapRef.value.getAllMarkers();
  }
  return markers.value;
};

// æ˜¾ç¤ºæ‰€æœ‰æ ‡è®°ç‚¹ä¿¡æ¯
const showAllMarkers = () => {
  const allMarkers = getAllMarkers();
  const count = allMarkers.length;

  if (count === 0) {
    ElMessage.warning("åœ°å›¾ä¸Šæ²¡æœ‰æ ‡è®°ç‚¹");
    return;
  }

  // æ¸…ç©ºå¹¶è®¾ç½®åŠ è½½çŠ¶æ€?  markerData.value = [];
  isLoadingMarkers.value = true;

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  setTimeout(() => {
    // å°†æ ‡è®°ç‚¹ä¿¡æ¯æ ¼å¼åŒ?    markerData.value = {
      description: "åœ°å›¾ä¸Šçš„æ‰€æœ‰æ ‡è®°ç‚¹",
      count: count,
      markers: allMarkers.map((marker, index) => {
        return {
          id: index + 1,
          position: [Number(marker.position[0].toFixed(6)), Number(marker.position[1].toFixed(6))],
          title: marker.title || `æ ‡è®°ç‚?{index + 1}`,
          data: marker.data || {},
        };
      }),
    };

    isLoadingMarkers.value = false;

    // æ˜¾ç¤ºæç¤º
    ElMessage.success(`åœ°å›¾ä¸Šå…±æœ?${count} ä¸ªæ ‡è®°ç‚¹`);
  }, 300);
};

// æ¸…é™¤æ‰€æœ‰å›¾å½?const clearShapes = () => {
  if (mapRef.value) {
    mapRef.value.clearShapes();
    drawnShapes.value = [];
    selectedShape.value = null;

    // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºæ¸…é™¤å›¾å½¢çš„ä¿¡æ?    markerData.value = {
      description: "å›¾å½¢æ“ä½œ",
      action: "å·²æ¸…é™¤æ‰€æœ‰å›¾å½?,
    };

    // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
    if (!showMarkerPanel.value) {
      toggleMarkerPanel();
    }

    ElMessage.success("å·²æ¸…é™¤æ‰€æœ‰å›¾å½?);
  }
};

// å¼€å§‹è½¨è¿¹åŠ¨ç”?const startTrackAnimation = () => {
  if (mapRef.value) {
    // å¦‚æœå½“å‰ä¸­å¿ƒç‚¹æ˜¯åŒ—äº¬ï¼Œå…ˆç§»åŠ¨åˆ°æ¤’æ±ŸåŒºåŸŸä»¥ä¾¿äºæ¼”ç¤º
    if (centerLocation.value === "beijing") {
      mapRef.value.setCenter([121.480, 28.640]);
      mapRef.value.setZoom(13);
      // å»¶è¿Ÿæ‰§è¡Œè½¨è¿¹åŠ¨ç”»ï¼Œç­‰å¾…åœ°å›¾å®Œæˆç§»åŠ?      setTimeout(() => {
        playTrackAnimationInCurrentView();
      }, 500);
    } else {
      // ç›´æ¥æ’­æ”¾è½¨è¿¹
      playTrackAnimationInCurrentView();
    }
  } else {
    ElMessage.warning("åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–");
  }
};

// åœ¨å½“å‰è§†å›¾ä¸­æ’­æ”¾è½¨è¿¹åŠ¨ç”»
const playTrackAnimationInCurrentView = () => {
  if (!mapRef.value) {
    ElMessage.warning("åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–");
    return;
  }
  
  const center = mapRef.value.getCenter ? mapRef.value.getCenter() : mapCenter.value;
  
  try {
    // åˆ›å»ºæ¤’æ±ŸåŒºåŸŸå‘¨è¾¹çš„æ¨¡æ‹Ÿè½¨è¿¹è·¯å¾?    const points = [
      // èµ·ç‚¹ï¼šæ¤’æ±ŸåŒºä¸­å¿ƒ
      [121.480, 28.640],
      // å‘ä¸œåŒ—æ–¹å‘å‰è¿?      [121.490, 28.645],
      [121.498, 28.652],
      [121.505, 28.660],
      // å‘ä¸œå—æ–¹å‘è½¬å¼?      [121.510, 28.655],
      [121.515, 28.648],
      [121.518, 28.639],
      // å‘å—æ–¹å‘
      [121.515, 28.630],
      [121.508, 28.625],
      // å‘è¥¿å—æ–¹å?      [121.500, 28.620],
      [121.490, 28.615],
      // å‘è¥¿
      [121.475, 28.618],
      [121.465, 28.622],
      // å‘è¥¿åŒ—æ–¹å?      [121.460, 28.630],
      [121.465, 28.638],
      // å›åˆ°æ¥è¿‘èµ·ç‚¹
      [121.472, 28.638],
      [121.480, 28.640]
    ];

    // è®¾ç½®è½¨è¿¹åŠ¨ç”»é€‰é¡¹
    const options = {
      icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
      iconSize: [25, 34],
      duration: 10000,  // 10ç§’å®Œæˆä¸€åœ?      loopCount: 2,     // å¾ªç¯ä¸¤æ¬¡
      lineColor: "#1890ff",
      lineWidth: 4,
      showTrack: true,
      showDirection: true,
      autoFit: true,
      passedLineColor: "#ff4d4f" // å·²ç»èµ°è¿‡çš„è·¯å¾„é¢œè‰²ä¸ºçº¢è‰²
    };

    // å¯åŠ¨è½¨è¿¹åŠ¨ç”»
    const result = mapRef.value.startTrackAnimation(points, options);
    
    if (!result) {
      ElMessage.error("å¯åŠ¨è½¨è¿¹åŠ¨ç”»å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å›¾ç»„ä»¶æ˜¯å¦æ”¯æŒè¯¥åŠŸèƒ½");
      return;
    }
    
    // æ›´æ–°çŠ¶æ€?    isTrackAnimationPlaying.value = true;
    isTrackAnimationPaused.value = false;

    // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºè½¨è¿¹ç‚¹ä¿¡æ?    markerData.value = {
      description: "è½¨è¿¹åŠ¨ç”»ä¿¡æ¯",
      count: points.length,
      center: {
        lng: Number(center[0].toFixed(6)),
        lat: Number(center[1].toFixed(6)),
      },
      duration: options.duration,
      loopCount: options.loopCount,
      points: points.slice(0, 5).map((point, index) => {
        return {
          id: index + 1,
          position: [Number(point[0].toFixed(6)), Number(point[1].toFixed(6))],
        };
      }),
      note: `æ˜¾ç¤º${points.length}ä¸ªè½¨è¿¹ç‚¹ä¸­çš„å‰?ä¸?..`,
    };

    // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
    if (!showMarkerPanel.value) {
      toggleMarkerPanel();
    }

    ElMessage.success("è½¨è¿¹åŠ¨ç”»å¼€å§‹æ’­æ”?);
  } catch (error) {
    console.error("æ’­æ”¾è½¨è¿¹åŠ¨ç”»å¤±è´¥:", error);
    ElMessage.error("æ’­æ”¾è½¨è¿¹åŠ¨ç”»å¤±è´¥ï¼Œå‘ç”Ÿé”™è¯?);
  }
};

// æ ¼å¼åŒ–å›¾å½¢åæ ?const formatShapeCoordinates = (shape) => {
  if (!shape) return "";

  if (shape.type === "circle") {
    return `ä¸­å¿ƒç‚? [${shape.path[0][0].toFixed(6)}, ${shape.path[0][1].toFixed(6)}]\nåŠå¾„: ${shape.radius.toFixed(2)}ç±³`;
  } else {
    let result = "";
    shape.path.forEach((point, index) => {
      result += `ç‚?{index + 1}: [${point[0].toFixed(6)}, ${point[1].toFixed(6)}]\n`;
    });
    return result;
  }
};

// æ ¹æ®å½“å‰é…ç½®ç”Ÿæˆä»£ç 
const codeExample = computed(() => {
  // ç®€å•çš„ç‰ˆæœ¬ï¼Œé¿å…æ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥—é—®é¢˜
  return `<template>
  <ScMap
    type="${mapType.value}"
    api-key="${apiKey.value[mapType.value]}"
    :center="[${mapCenter.value[0]}, ${mapCenter.value[1]}]"
    :zoom="${zoomLevel.value}"
    height="${height.value}"
    view-type="${viewType.value}"
    :script-config="scriptConfig"
    @map-loaded="onMapLoaded"
    @marker-click="onMarkerClick">
  </ScMap>
</template>`;
});

// æ ‡è®°ç‚¹æ•°æ®é¢æ?const showMarkerPanel = ref(false);
const markerData = ref([]);
const isLoadingMarkers = ref(false);

// åˆ‡æ¢æ ‡è®°ç‚¹æ•°æ®é¢æ¿æ˜¾ç¤?éšè—
const toggleMarkerPanel = () => {
  showMarkerPanel.value = !showMarkerPanel.value;
};

// æ˜¾ç¤ºåœ°å›¾å¯è§†åŒºåŸŸçš„å››ä¸ªè§’åæ ‡
const showViewBounds = () => {
  if (!mapRef.value) {
    ElMessage.warning("åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–");
    return;
  }

  const bounds = mapRef.value.getVisibleBounds();
  if (!bounds) {
    ElMessage.warning("è·å–å¯è§†åŒºåŸŸè¾¹ç•Œå¤±è´¥");
    return;
  }

  // æ¸…ç©ºå¹¶è®¾ç½®åŠ è½½çŠ¶æ€?  markerData.value = [];
  isLoadingMarkers.value = true;

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  setTimeout(() => {
    // æ ¼å¼åŒ–åæ ‡æ•°æ®ï¼Œä¾¿äºæŸ¥çœ‹
    const formattedBounds = {
      description: "å½“å‰åœ°å›¾å¯è§†åŒºåŸŸè¾¹ç•Œåæ ‡",
      northWest: {
        lng: Number(bounds[0][0].toFixed(6)),
        lat: Number(bounds[0][1].toFixed(6)),
      },
      northEast: {
        lng: Number(bounds[1][0].toFixed(6)),
        lat: Number(bounds[1][1].toFixed(6)),
      },
      southEast: {
        lng: Number(bounds[2][0].toFixed(6)),
        lat: Number(bounds[2][1].toFixed(6)),
      },
      southWest: {
        lng: Number(bounds[3][0].toFixed(6)),
        lat: Number(bounds[3][1].toFixed(6)),
      },
      center: {
        lng: Number(((bounds[0][0] + bounds[2][0]) / 2).toFixed(6)),
        lat: Number(((bounds[0][1] + bounds[2][1]) / 2).toFixed(6)),
      },
    };

    // æ›´æ–°æ•°æ®
    markerData.value = formattedBounds;
    isLoadingMarkers.value = false;

    // æ˜¾ç¤ºæç¤º
    ElMessage.success("å·²è·å–åœ°å›¾å¯è§†åŒºåŸŸåæ ?);
  }, 300);
};

// è·å–å¯è§†èŒƒå›´å†…æ ‡è®°ç‚¹
const getVisibleMarkers = () => {
  if (!mapRef.value) {
    ElMessage.warning("åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–");
    return;
  }

  // æ¸…ç©ºå¹¶è®¾ç½®åŠ è½½çŠ¶æ€?  markerData.value = [];
  isLoadingMarkers.value = true;

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  setTimeout(() => {
    try {
      // è°ƒç”¨åœ°å›¾ç»„ä»¶çš„æ–¹æ³•è·å–å¯è§†èŒƒå›´å†…çš„æ ‡è®°ç‚¹
      const visibleMarkers = mapRef.value.getVisibleMarkers();
      const count = visibleMarkers.length;

      if (count === 0) {
        markerData.value = {
          description: "å¯è§†èŒƒå›´å†…æ²¡æœ‰æ ‡è®°ç‚¹",
          count: 0,
        };
        ElMessage.warning("å¯è§†èŒƒå›´å†…æ²¡æœ‰æ ‡è®°ç‚¹");
      } else {
        // å°†æ ‡è®°ç‚¹ä¿¡æ¯æ ¼å¼åŒ?        markerData.value = {
          description: "å¯è§†èŒƒå›´å†…çš„æ ‡è®°ç‚?,
          count: count,
          markers: visibleMarkers.map((marker, index) => {
            return {
              id: index + 1,
              position: [Number(marker.position[0].toFixed(6)), Number(marker.position[1].toFixed(6))],
              title: marker.title || `æ ‡è®°ç‚?{index + 1}`,
              data: marker.data || {},
            };
          }),
        };

        // æ˜¾ç¤ºæç¤º
        ElMessage.success(`å¯è§†èŒƒå›´å†…å…±æœ?${count} ä¸ªæ ‡è®°ç‚¹`);
      }
    } catch (error) {
      console.error("è·å–å¯è§†èŒƒå›´å†…æ ‡è®°ç‚¹å¤±è´¥:", error);
      markerData.value = {
        description: "è·å–å¯è§†èŒƒå›´å†…æ ‡è®°ç‚¹å¤±è´¥",
        error: error.message,
      };
      ElMessage.error("è·å–å¯è§†èŒƒå›´å†…æ ‡è®°ç‚¹å¤±è´¥");
    } finally {
      isLoadingMarkers.value = false;
    }
  }, 300);
};

// æ·»åŠ èšåˆç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°
const onClusterClick = (event) => {
  console.log("èšåˆç‚¹å‡»äº‹ä»¶", event);

  // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºèšåˆç‚¹ä¿¡æ?  markerData.value = {
    description: "èšåˆç‚¹ä¿¡æ?,
    position: [Number(event.position[0].toFixed(6)), Number(event.position[1].toFixed(6))],
    count: event.count,
    totalWeight: event.totalWeight,
    markers: event.markers.slice(0, 5).map((marker, index) => {
      return {
        id: index + 1,
        position: marker.position ? [
          Number(marker.position[0].toFixed(6)),
          Number(marker.position[1].toFixed(6))
        ] : "æœªçŸ¥",
        title: marker.title || `æ ‡è®°ç‚?{index + 1}`,
        weight: marker.weight || 1,
        data: marker.data || {}
      };
    }),
    note: event.markers.length > 5 ? `ä»…æ˜¾ç¤ºå‰5ä¸ªæ ‡è®°ç‚¹ï¼Œå…±${event.markers.length}ä¸ª` : ""
  };

  // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
  if (!showMarkerPanel.value) {
    toggleMarkerPanel();
  }

  // è®°å½•æ—¥å¿—
  console.log(`èšåˆç‚¹è¢«ç‚¹å‡»ï¼ŒåŒ…å?{event.count}ä¸ªæ ‡è®°ç‚¹ï¼Œä½ç½? [${event.position[0].toFixed(6)}, ${event.position[1].toFixed(6)}]`);

  ElMessage.info(`ç‚¹å‡»äº†åŒ…å?{event.count}ä¸ªæ ‡è®°ç‚¹çš„èšåˆç‚¹`);
};

const currentDrawing = ref("");
const drawnShapes = ref([]);
const selectedShape = ref(null);

// ç”Ÿæˆéšæœºç»çº¬åº?const randomPosition = (center, radius) => {
  const [lng, lat] = center;
  const lngRadius = radius / 111000 * Math.cos(lat * Math.PI / 180);
  const latRadius = radius / 111000;

  const randomLng = lng + (Math.random() * 2 - 1) * lngRadius;
  const randomLat = lat + (Math.random() * 2 - 1) * latRadius;

  return [randomLng, randomLat];
};

// æ·»åŠ å¼¹çª—äº‹ä»¶å¤„ç†
const onHoverPopoverShow = (data) => {
  console.log("æ‚¬åœå¼¹çª—æ˜¾ç¤º:", data);
};

const onHoverPopoverHide = (data) => {
  console.log("æ‚¬åœå¼¹çª—éšè—:", data);
};

const onClickPopoverShow = (data) => {
  console.log("ç‚¹å‡»å¼¹çª—æ˜¾ç¤º:", data);
};

const onClickPopoverHide = (data) => {
  console.log("ç‚¹å‡»å¼¹çª—éšè—:", data);
  console.trace('ç‚¹å‡»å¼¹çª—éšè—');
};

// åˆ‡æ¢æ ‡è®°ç‚¹æ˜¾ç¤?éšè—
const toggleMarkersVisibility = () => {
  if (mapRef.value) {
    // æ ¹æ®é€‰é¡¹çš„å€¼åˆ‡æ¢æ ‡è®°ç‚¹çš„å¯è§æ€?    mapRef.value.toggleMarkers(toolsOptions.value.showMarkers);
    ElMessage.success(`${toolsOptions.value.showMarkers ? 'æ˜¾ç¤º' : 'éšè—'}æ‰€æœ‰æ ‡è®°ç‚¹`);
  }
};

// åˆ‡æ¢å›¾å½¢æ˜¾ç¤º/éšè—
const toggleShapesVisibility = () => {
  if (mapRef.value) {
    // æ ¹æ®é€‰é¡¹çš„å€¼åˆ‡æ¢å›¾å½¢çš„å¯è§æ€?    mapRef.value.toggleShapes(toolsOptions.value.showShapes);
    ElMessage.success(`${toolsOptions.value.showShapes ? 'æ˜¾ç¤º' : 'éšè—'}æ‰€æœ‰å›¾å½¢`);
  }
};

// æ ‡è®°ç‚¹åˆ é™¤äº‹ä»?const onMarkerDeleted = (event) => {
  console.log("æ ‡è®°ç‚¹åˆ é™¤äº‹ä»?, event);
};

// æ¤’æ±ŸåŒºè¾¹ç•Œåæ ‡æ•°æ?(ç®€åŒ–ç‰ˆ)
const jiaojiangBoundaryCoords = [
  [121.442624, 28.681966],
  [121.461807, 28.689873],
  [121.479145, 28.684521],
  [121.491462, 28.673816],
  [121.503265, 28.661657],
  [121.515411, 28.648412],
  [121.527213, 28.635082],
  [121.533607, 28.620613],
  [121.528458, 28.606143],
  [121.513481, 28.594414],
  [121.492157, 28.587824],
  [121.476322, 28.592316],
  [121.461029, 28.601300],
  [121.449226, 28.614312],
  [121.441040, 28.629237],
  [121.436920, 28.646298],
  [121.438904, 28.664227],
  [121.442624, 28.681966]
];

// ç»˜åˆ¶æ¤’æ±Ÿè¾¹ç•Œ
const drawJiaojiangBoundary = () => {
  if (!mapRef.value) {
    ElMessage.warning("åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–");
    return;
  }
  
  try {
    // å°†ä¸­å¿ƒç‚¹è®¾ç½®åˆ°æ¤’æ±ŸåŒºåŸ?    mapRef.value.setCenter([121.480, 28.640]);
    mapRef.value.setZoom(12);
    
    console.log("å¼€å§‹ç»˜åˆ¶æ¤’æ±Ÿè¾¹ç•?..");
    
    // ç»˜åˆ¶å¤šè¾¹å½¢è¾¹ç•Œï¼Œåªæœ‰è¾¹æ¡†æ²¡æœ‰å¡«å……
    const polygonId = mapRef.value.addPolygon(
      jiaojiangBoundaryCoords,
      {
        strokeColor: '#f5222d',  // çº¢è‰²è¾¹æ¡†
        strokeWeight: 3,         // è¾¹æ¡†å®½åº¦
        strokeOpacity: 0.9,      // è¾¹æ¡†ä¸é€æ˜åº?        fillColor: '#f5222d',    // å¡«å……é¢œè‰²ï¼ˆå®é™…ä¸Šä¸ä¼šæ˜¾ç¤ºï¼?        fillOpacity: 0           // å…³é”®è®¾ç½®ï¼šå¡«å……å®Œå…¨é€æ˜
      },
      'jiaojiang-boundary'
    );
    
    console.log("æ¤’æ±Ÿè¾¹ç•Œç»˜åˆ¶ç»“æœ:", polygonId);
    
    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
    ElMessage.success("å·²ç»˜åˆ¶æ¤’æ±ŸåŒºè¾¹ç•Œ");
    
    // æ›´æ–°æ˜¾ç¤ºæ•°æ®
    markerData.value = {
      description: "å·²ç»˜åˆ¶æ¤’æ±ŸåŒºè¾¹ç•Œ",
      id: polygonId,
      type: "polygon",
      boundary: "æ¤’æ±ŸåŒ?,
      points: jiaojiangBoundaryCoords.length,
      coordinates: jiaojiangBoundaryCoords,
      style: {
        strokeColor: '#f5222d',
        strokeWeight: 3,
        strokeOpacity: 0.9,
        fillOpacity: 0
      }
    };
    
    // æ˜¾ç¤ºæ•°æ®é¢æ¿
    showMarkerPanel.value = true;
    
  } catch (error) {
    console.error("ç»˜åˆ¶æ¤’æ±Ÿè¾¹ç•Œå¤±è´¥:", error);
    ElMessage.error("ç»˜åˆ¶æ¤’æ±Ÿè¾¹ç•Œå¤±è´¥");
  }
};

// åŠ¨ç”»æ§åˆ¶çŠ¶æ€?const isTrackAnimationPlaying = ref(false);
const isTrackAnimationPaused = ref(false);

// è¡Œç¨‹è½¨è¿¹åŠŸèƒ½ç›¸å…³çŠ¶æ€?const showJourneyOptions = ref(true); // æ˜¯å¦æ˜¾ç¤ºè¡Œç¨‹è½¨è¿¹è¯¦ç»†é€‰é¡¹
const journeyOptions = ref({
  strokeColor: '#1890FF',
  strokeWeight: 5,
  strokeOpacity: 0.8,
  strokeStyle: 'solid',
  showStartEndMarkers: true,
  showPointMarkers: false,
  pointMarkersInterval: 3,
  animation: false,
  animationDurationInSeconds: 10,
  loopCount: 1, // Ñ­»·´ÎÊıÅäÖÃ
  startTitle: 'èµ·ç‚¹',
  endTitle: 'ç»ˆç‚¹',
  autoFit: true
});
const journeyTrackInstance = ref(null);
const isJourneyAnimationPaused = ref(false);



// åˆ›å»ºè¡Œç¨‹è½¨è¿¹
const createJourneyTrack = (customPoints = null) => {
  if (!mapRef.value) {
    ElMessage.warning('åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–');
    return;
  }
  
  if (journeyTrackInstance.value) {
    // å…ˆæ¸…é™¤å·²æœ‰çš„è½¨è¿¹
    clearJourneyTrack();
  }
  
  try {
    // ä½¿ç”¨è‡ªå®šä¹‰è½¨è¿¹ç‚¹æˆ–é»˜è®¤ç¤ºä¾‹è½¨è¿?    const points = customPoints || [
      // èµ·ç‚¹ï¼šæ¤’æ±ŸåŒºä¸­å¿ƒ
      [121.480, 28.640],
      // å‘ä¸œåŒ—æ–¹å‘å‰è¿?      [121.490, 28.645],
      [121.498, 28.652],
      [121.505, 28.660],
      // å‘ä¸œå—æ–¹å‘è½¬å¼?      [121.510, 28.655],
      [121.515, 28.648],
      [121.518, 28.639],
      // å‘å—æ–¹å‘
      [121.515, 28.630],
      [121.508, 28.625],
      // å‘è¥¿å—æ–¹å?      [121.500, 28.620],
      [121.490, 28.615],
      // å‘è¥¿
      [121.475, 28.618],
      [121.465, 28.622],
      // å‘è¥¿åŒ—æ–¹å?      [121.460, 28.630],
      [121.465, 28.638],
      // å›åˆ°æ¥è¿‘èµ·ç‚¹
      [121.472, 28.638],
      [121.480, 28.640]
    ];
    
    // å‡†å¤‡é€‰é¡¹
    const options = {
      ...journeyOptions.value,
      animationDuration: journeyOptions.value.animationDurationInSeconds * 1000,
      animationAutoPlay: true,
    };
    
    // åˆ›å»ºè¡Œç¨‹è½¨è¿¹
    journeyTrackInstance.value = mapRef.value.createJourneyTrack(points, options);
    
    if (!journeyTrackInstance.value) {
      ElMessage.error('åˆ›å»ºè¡Œç¨‹è½¨è¿¹å¤±è´¥');
      return;
    }
    
    // æ›´æ–°çŠ¶æ€?    isJourneyAnimationPaused.value = false;
    
    // åœ¨æ•°æ®é¢æ¿ä¸­æ˜¾ç¤ºè¡Œç¨‹è½¨è¿¹ä¿¡æ¯
    markerData.value = {
      description: 'è¡Œç¨‹è½¨è¿¹ä¿¡æ¯',
      points: points.length,
      startPoint: [points[0][0].toFixed(6), points[0][1].toFixed(6)],
      endPoint: [points[points.length-1][0].toFixed(6), points[points.length-1][1].toFixed(6)],
      distance: 'çº?' + (points.length * 0.3).toFixed(1) + ' å…¬é‡Œ', // ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”¨ä¸­åº”è¯¥è®¡ç®—çœŸå®è·ç¦?      options: {
        çº¿é¢œè‰? journeyOptions.value.strokeColor,
        çº¿å®½åº? journeyOptions.value.strokeWeight,
        æ˜¾ç¤ºèµ·ç»ˆç‚? journeyOptions.value.showStartEndMarkers ? 'æ˜? : 'å?,
        æ˜¾ç¤ºé€”ç»ç‚? journeyOptions.value.showPointMarkers ? 'æ˜? : 'å?,
        æ’­æ”¾åŠ¨ç”»: journeyOptions.value.animation ? 'æ˜? : 'å?
      }
    };
    
    // è‡ªåŠ¨å±•å¼€æ•°æ®é¢æ¿
    if (!showMarkerPanel.value) {
      toggleMarkerPanel();
    }
    
    ElMessage.success('è¡Œç¨‹è½¨è¿¹åˆ›å»ºæˆåŠŸ');
  } catch (error) {
    console.error('åˆ›å»ºè¡Œç¨‹è½¨è¿¹å¤±è´¥:', error);
    ElMessage.error('åˆ›å»ºè¡Œç¨‹è½¨è¿¹å¤±è´¥ï¼Œå‘ç”Ÿé”™è¯?);
  }
};

// æ¸…é™¤è¡Œç¨‹è½¨è¿¹
const clearJourneyTrack = () => {
  if (journeyTrackInstance.value && mapRef.value) {
    journeyTrackInstance.value.clear();
    journeyTrackInstance.value = null;
    isJourneyAnimationPaused.value = false;
    ElMessage.warning('è¡Œç¨‹è½¨è¿¹å·²æ¸…é™?);
  }
};

// æš‚åœè¡Œç¨‹è½¨è¿¹åŠ¨ç”»
const pauseJourneyAnimation = () => {
  if (journeyTrackInstance.value) {
    journeyTrackInstance.value.pause();
    isJourneyAnimationPaused.value = true;
    ElMessage.info('è¡Œç¨‹è½¨è¿¹åŠ¨ç”»å·²æš‚å?);
  }
};

// æ¢å¤è¡Œç¨‹è½¨è¿¹åŠ¨ç”»
const resumeJourneyAnimation = () => {
  if (journeyTrackInstance.value && isJourneyAnimationPaused.value) {
    journeyTrackInstance.value.play();
    isJourneyAnimationPaused.value = false;
    ElMessage.success('è¡Œç¨‹è½¨è¿¹åŠ¨ç”»å·²ç»§ç»?);
  }
};

// åœæ­¢è¡Œç¨‹è½¨è¿¹åŠ¨ç”»
const stopJourneyAnimation = () => {
  if (journeyTrackInstance.value) {
    journeyTrackInstance.value.stop();
    isJourneyAnimationPaused.value = false;
    ElMessage.warning('è¡Œç¨‹è½¨è¿¹åŠ¨ç”»å·²åœæ­?);
  }
};

// åˆ‡æ¢è¡Œç¨‹è½¨è¿¹é€‰é¡¹æ˜¾ç¤º/éšè—
const toggleJourneyOptions = () => {
  showJourneyOptions.value = !showJourneyOptions.value;
};

// ç”Ÿæˆéšæœºè½¨è¿¹
const generateRandomTrack = () => {
  if (!mapRef.value) {
    ElMessage.warning('åœ°å›¾ç»„ä»¶æœªåˆå§‹åŒ–');
    return;
  }
  
  // è·å–å½“å‰åœ°å›¾ä¸­å¿ƒ
  const center = mapRef.value.getCenter ? mapRef.value.getCenter() : mapCenter.value;
  
  // ç”Ÿæˆå›´ç»•ä¸­å¿ƒç‚¹çš„éšæœºè½¨è¿¹
  const generateRandomPoint = (center, radiusKm) => {
    const earthRadius = 6371; // åœ°çƒåŠå¾„ï¼Œå•ä½ï¼šåƒç±³
    const lat = center[1];
    const lng = center[0];
    
    // éšæœºè·ç¦»ï¼Œåœ¨0åˆ°æŒ‡å®šåŠå¾„ä¹‹é—?    const distance = Math.random() * radiusKm;
    
    // éšæœºè§’åº¦ï¼?åˆ?60åº?    const angle = Math.random() * Math.PI * 2;
    
    // è®¡ç®—åç§»é‡ï¼ˆè¿‘ä¼¼è®¡ç®—ï¼?    const latOffset = (distance / earthRadius) * (180 / Math.PI);
    const lngOffset = (distance / earthRadius) * (180 / Math.PI) / Math.cos(lat * Math.PI / 180);
    
    // è®¡ç®—æ–°åæ ?    const newLat = lat + latOffset * Math.sin(angle);
    const newLng = lng + lngOffset * Math.cos(angle);
    
    return [newLng, newLat];
  };
  
  // ç”Ÿæˆéšæœºç‚¹æ•°é‡ï¼Œ5-15ä¸ªç‚¹
  const pointCount = 5 + Math.floor(Math.random() * 10);
  const points = [];
  
  // ç”Ÿæˆèµ·ç‚¹ï¼ˆå½“å‰åœ°å›¾ä¸­å¿ƒï¼‰
  points.push(center);
  
  // ç”Ÿæˆä¸­é—´ç‚?  for (let i = 0; i < pointCount; i++) {
    points.push(generateRandomPoint(center, 3)); // 3åƒç±³åŠå¾„å†…çš„éšæœºç‚?  }
  
  // æœ€åä¸€ä¸ªç‚¹å›åˆ°èµ·ç‚¹é™„è¿‘
  const lastPoint = generateRandomPoint(center, 0.5); // 0.5åƒç±³åŠå¾„å†…çš„éšæœºç‚?  points.push(lastPoint);
  
  // è®¾ç½®é€‰é¡¹
  journeyOptions.value.animation = true; // å¯ç”¨åŠ¨ç”»
  journeyOptions.value.showStartEndMarkers = true; // æ˜¾ç¤ºèµ·ç»ˆç‚?  
  // åˆ›å»ºè½¨è¿¹
  createJourneyTrack(points);
  
  ElMessage.success(`å·²ç”ŸæˆåŒ…å?{points.length}ä¸ªç‚¹çš„éšæœºè½¨è¿¹`);
};

</script>

<style scoped>
.sc-map-example {
  position: relative;
  display: flex;
  flex-direction: column;
}

.card-header h3 {
  margin: 0 0 8px 0;
  font-size: 22px;
}

.text-secondary {
  color: #909399;
  margin: 0;
}

.main-container {
  display: flex;
  flex-direction: row; /* æ”¹ä¸ºè¡Œå¸ƒå±€ï¼Œä½¿åœ°å›¾åœ¨å·¦è¾¹ï¼Œé…ç½®åœ¨å³è¾?*/
  gap: 20px;
  margin-bottom: 20px;
  height: auto;
}

.map-section {
  flex: 3;
  min-width: 500px;
  display: flex;
  flex-direction: column;
  order: 1; /* ç¡®ä¿åœ°å›¾åŒºåŸŸåœ¨å·¦ä¾?*/
}

.config-section {
  flex: 2;
  min-width: 300px;
  max-width: 400px; /* é™åˆ¶é…ç½®é¢æ¿çš„æœ€å¤§å®½åº?*/
  display: flex;
  flex-direction: column;
  order: 2; /* ç¡®ä¿é…ç½®åŒºåŸŸåœ¨å³ä¾?*/
}

.preview-container {
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.preview-container .action-buttons {
  margin-top: 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.preview-container .action-buttons .el-button {
  margin: 4px; /* ç»™æŒ‰é’®å¢åŠ ä¸€äº›é—´è·?*/
}

.config-scroll-container {
  height: 700px; /* å‡å°é…ç½®é¢æ¿çš„é«˜åº¦ï¼Œä¸åœ°å›¾æ›´åŒ¹é… */
  overflow-y: auto;
  padding: 16px;
  border-radius: 8px;
  background-color: rgba(250, 250, 250, 0.8);
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.05);
}

/* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
.config-scroll-container::-webkit-scrollbar {
  width: 6px;
}

.config-scroll-container::-webkit-scrollbar-track {
  background: rgba(240, 240, 240, 0.5);
  border-radius: 10px;
}

.config-scroll-container::-webkit-scrollbar-thumb {
  background: rgba(200, 200, 200, 0.7);
  border-radius: 10px;
}

.config-scroll-container::-webkit-scrollbar-thumb:hover {
  background: rgba(180, 180, 180, 0.9);
}

/* ç¡®ä¿è¡¨å•å…ƒç´ åœ¨æ»šåŠ¨å®¹å™¨ä¸­æœ‰é€‚å½“çš„é—´è·?*/
.config-scroll-container .el-form {
  padding: 10px 5px;
}

h4 {
  margin-top: 0;
  margin-bottom: 16px;
  font-size: 18px;
  color: #303133;
}

.w-100 {
  width: 100%;
}

.mt-2 {
  margin-top: 8px;
}

.mt-4 {
  margin-top: 16px;
}

.mb-1 {
  margin-bottom: 4px;
}

.mb-2 {
  margin-bottom: 8px;
}

.mb-3 {
  margin-bottom: 12px;
}

.height-hint {
  color: #909399;
  font-size: 12px;
  margin-top: 4px;
  text-align: center;
}

.center-coords {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 8px;
}

.control-options {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.tools-checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 8px;
}

.shape-info-label {
  font-weight: 500;
  font-size: 14px;
}

.custom-drawing-tools {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 8px 0;
  padding: 8px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.cluster-param-control {
  margin-bottom: 12px;
}

.param-label {
  margin-bottom: 4px;
  font-size: 13px;
  color: #606266;
}

code {
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
  font-size: 14px;
}

pre {
  background-color: #f5f7fa;
  padding: 15px;
  border-radius: 4px;
  overflow-x: auto;
  margin: 0;
}

.marker-data-panel {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 320px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 8px;
  box-shadow: 0 3px 16px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  max-height: calc(100vh - 40px);
  display: flex;
  flex-direction: column;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  overflow: hidden;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(235, 235, 235, 0.8);
}

.marker-data-panel.expanded {
  height: 400px;
}

.marker-data-panel:not(.expanded) {
  height: 42px;
}

.panel-header {
  padding: 10px 15px;
  background: rgba(245, 247, 250, 0.8);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e6e6e6;
  font-weight: 600;
  font-size: 14px;
  color: #303133;
  user-select: none;
}

.panel-header:hover {
  background: rgba(235, 242, 250, 0.9);
}

.panel-content {
  padding: 15px;
  overflow-y: auto;
  flex: 1;
}

.json-content {
  background: rgba(248, 249, 250, 0.7);
  padding: 12px;
  border-radius: 6px;
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
  font-size: 12px;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  border: 1px solid #ebeef5;
}

.loading-data {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100px;
  color: #909399;
}

.loading-data i {
  margin-right: 8px;
  font-size: 18px;
}

.code-example {
  margin-top: 20px;
  border-top: 1px solid #ebeef5;
  padding-top: 20px;
}

.code-example h4 {
  display: flex;
  align-items: center;
}

.code-example h4::before {
  content: "";
  display: inline-block;
  width: 4px;
  height: 18px;
  background-color: #409eff;
  margin-right: 8px;
  border-radius: 2px;
}

.code-example pre {
  background-color: #f8f9fa;
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
  border: 1px solid #ebeef5;
  overflow-x: auto;
  max-height: 300px;
}

@media (max-width: 1200px) {
  .main-container {
    flex-direction: column; /* åœ¨å°å±å¹•ä¸Šæ”¹å›åˆ—å¸ƒå±€ */
  }

  .map-section,
  .config-section {
    width: 100%;
    min-width: 100%; /* ç¡®ä¿åœ¨å°å±å¹•ä¸Šå æ®å…¨å®?*/
    max-width: 100%; /* ç¡®ä¿åœ¨å°å±å¹•ä¸Šå æ®å…¨å®?*/
    order: 0; /* é‡ç½®æ’åº */
  }
  
  .map-section {
    order: 1; /* åœ¨å°å±å¹•ä¸Šåœ°å›¾åœ¨ä¸Šæ–¹ */
  }
  
  .config-section {
    order: 2; /* åœ¨å°å±å¹•ä¸Šé…ç½®åœ¨ä¸‹æ–¹ */
  }
  
  .config-scroll-container {
    height: 400px; /* å‡å°é…ç½®é¢æ¿çš„é«˜åº¦ä»¥é€‚åº”å°å±å¹?*/
  }
  
  .preview-container .action-buttons {
    flex-direction: column;
    align-items: stretch;
  }
  
  .preview-container .action-buttons .el-button-group {
    display: flex;
    flex-wrap: wrap;
  }
  
  .preview-container .action-buttons .el-button {
    flex: 1;
    margin: 2px;
  }
  
  .code-example pre {
    max-height: 200px; /* åœ¨å°å±å¹•ä¸Šå‡å°ä»£ç ç¤ºä¾‹çš„é«˜åº¦ */
  }
}

.journey-track-controls {
  margin-top: 15px;
  padding: 15px;
  background: rgba(250, 250, 250, 0.8);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.journey-track-controls h5 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0 0 10px 0;
  font-size: 16px;
}

.journey-options {
  padding: 10px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 6px;
  border: 1px solid #ebeef5;
}

.journey-checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin: 12px 0;
}

.journey-options-panel {
  background: rgba(250, 250, 250, 0.6);
  border-radius: 8px;
  border: 1px solid #ebeef5;
  padding: 10px;
  margin-top: 5px;
}

.journey-options-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.journey-checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin: 12px 0;
}

.journey-buttons {
  display: flex;
  justify-content: flex-start;
}

.journey-animation-controls {
  display: flex;
  gap: 5px;
}
</style>


